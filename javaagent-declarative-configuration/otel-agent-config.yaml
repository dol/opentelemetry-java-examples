# For schema documentation, including required properties, semantics, default behavior, etc,
# see: https://github.com/open-telemetry/opentelemetry-configuration/blob/main/schema-docs.md

file_format: "1.0-rc.2"

resource:
  attributes:
    - name: service.name
      value: spring-boot-declarative-config-example
  # Read resource attributes from the OTEL_RESOURCE_ATTRIBUTES environment variable.
  # This aligns well with the OpenTelemetry Operator and other deployment methods.
  attributes_list: ${OTEL_RESOURCE_ATTRIBUTES}
  detection/development: # /development properties may not be supported in all SDKs
    detectors:
      - service: # will add "service.instance.id" and "service.name" from the OTEL_SERVICE_NAME env var
      - host:
      - process:
      - container:

propagator:
  composite:
    - tracecontext:
    - baggage:

# Read backend endpoint from the OTEL_EXPORTER_OTLP_ENDPOINT environment variable.
# This aligns well with the OpenTelemetry Operator and other deployment methods.

tracer_provider:
  processors:
    - batch:
        exporter:
          otlp_http:
            endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://localhost:4318}/v1/traces

    # Configure a console exporter for exploring without a collector/backend
    - batch:
        exporter:
          console:

  # Configure sampling to exclude health check endpoints
  sampler:
    parent_based:
      root:
        cel_based:
          fallback_sampler:
            always_on:
          expressions:
            # Drop health check endpoints
            - action: DROP
              expression: spanKind == 'SERVER' && attribute['url.path'].startsWith('/health')
            # Drop actuator endpoints
            - action: DROP
              expression: spanKind == 'SERVER' && attribute['url.path'].startsWith('/actuator')
            # Sample only HTTP GET requests with successful responses
            - action: RECORD_AND_SAMPLE
              expression: spanKind == 'SERVER' && attribute['http.method'] == 'GET' && attribute['http.status_code'] < 400
            # Selectively sample based on span name
            - action: RECORD_AND_SAMPLE
              expression: name.contains('checkout') || name.contains('payment')
            # Drop spans with specific name patterns
            - action: DROP
              expression: name.matches('.*internal.*') && spanKind == 'INTERNAL'


meter_provider:
  readers:
    - periodic:
        exporter:
          otlp_http:
            endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://localhost:4318}/v1/metrics

logger_provider:
  processors:
    - batch:
        exporter:
          otlp_http:
            endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:-http://localhost:4318}/v1/logs
